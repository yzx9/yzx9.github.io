<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rust 与 Ownership | Zexin Yuan's blog</title>
    <meta name="description" content="Technique && Life">
    <meta name="generator" content="VitePress v1.0.0-rc.31">
    <link rel="preload stylesheet" href="/assets/style.7KPz2QOk.css" as="style">
    
    <script type="module" src="/assets/app.gAq3z2Ux.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.heUNgYAJ.js">
    <link rel="modulepreload" href="/assets/chunks/theme.ieC1e_b3.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-817c8e44.dpIRLGqT.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-61eb444c.zw7h_gov.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-2f8f667a.OPjcVpH1.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-9cfc3649.Zcpz2Ona.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-6b463803.HAEc5dLF.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-db6931fb.MpY6H5QL.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-a336098b.B9b6LpQL.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-a5166659.rYRD-Rk-.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-6c355bbc.2uPtYTXM.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-f746c04c.T1KcqWtS.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-4038b16c.Qg25LO_O.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-465a088a.nBbUtL6f.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-48ab76fb.Auywqfma.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-8ecb0bfc._zufkJKa.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-b620d43f.niEWTcTB.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-2671c3d1.NQr_BRr5.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-deae3313.y6MdK2G2.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-e097735e.H-m1ftw0.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-732a2638.Bb3fpnVU.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-617cf8dd.qNASTIdR.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-6db3d513.di2evce1.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.AhCe4kHV.js">
    <link rel="modulepreload" href="/assets/posts_2021_06_19_rust-and-ownership.md.bNgm5KjL.lean.js">
    <link rel="icon" href="/icon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="layout page"><main class="layout__main"><!--[--><article class="page__article p-10 vp-doc max-w-none"><div style="position:relative;"><div><h1 id="rust-与-ownership" tabindex="-1">Rust 与 Ownership <a class="header-anchor" href="#rust-与-ownership" aria-label="Permalink to &quot;Rust 与 Ownership&quot;">​</a></h1><p>所有权系统是 Rust 最具特色的地方，其理念并不复杂：任何变量都有所有权，没有所有权就不能用它。但是其理念深刻左右了 Rust 处处设计。</p><h2 id="简单的生命周期" tabindex="-1">简单的生命周期 <a class="header-anchor" href="#简单的生命周期" aria-label="Permalink to &quot;简单的生命周期&quot;">​</a></h2><p>一个变量最简单的生命周期应该包含了 <code>before created</code>、<code>created</code>、<code>droped</code></p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                      // s 在这里无效, 它尚未声明</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 从此处起，s 是有效的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 使用 s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                      // 此作用域已结束，s 不再有效</span></span></code></pre></div><p>这个变量将在堆上创建一个变量区域，当离开作用域后被释放。代码常常不是这么理想，现在我们需要将一个变量赋值给另一个变量。</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s1;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{}, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, s1);</span></span></code></pre></div><p>然后编译它：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error[E0382]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> moved</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> --&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/main.rs:5:28</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     let</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> moved</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> here</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     println!(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;{}, world!&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                            ^^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> used</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> here</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> move</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">note:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> move</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> occurs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> because</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std::string::String</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> which</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> does</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> implement</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Copy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trait</span></span></code></pre></div><p>啊哈！其他语言中最常见的代码也能报错？仔细看看，我们会发现编译器提示我们变量已经被移动（Move），这就是 Rust 的神奇之处，<code>x</code> 创建了一个引用类型，赋值时候只是简单的按位复制了这个指针。理所当然的，值类型可以被复制：</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{} + {} = {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, x, y, x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y);</span></span></code></pre></div><p>实际上，Rust 实现了两个 trait: <code>Copy</code> and <code>Drop</code>，两者不可同时实现。</p><p>最后，我们来看一个例子：</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // s 进入作用域</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    takes_ownership</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // s 的值移动到函数里 ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                    // ... 所以到这里不再有效</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                      // x 进入作用域</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    makes_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  // x 应该移动函数里，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                    // 但 i32 是 Copy 的，所以在后面可继续使用 x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 这里, x 先移出了作用域，然后是 s。但因为 s 的值已被移走，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 所以不会有特殊操作</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> takes_ownership</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(some_string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // some_string 进入作用域</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, some_string);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 这里，some_string 移出作用域并调用 `drop` 方法。占用的内存被释放</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> makes_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(some_integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // some_integer 进入作用域</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, some_integer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 这里，some_integer 移出作用域。不会有特殊操作</span></span></code></pre></div><h2 id="引用与借用" tabindex="-1">引用与借用 <a class="header-anchor" href="#引用与借用" aria-label="Permalink to &quot;引用与借用&quot;">​</a></h2><p>使用变量调用一个函数后就不能再使用它往往不是我们所期望的，我们可以将其再次返回，使得所有权回到我们手上：</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> takes_and_returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s1);</span></span></code></pre></div><p>不过更好的方法是使用引用<code>&amp;</code>，它们允许你使用值但不获取其所有权，将变量借给其他函数用用：</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">borrow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">s1);</span></span></code></pre></div><p>不过既然是借用的，当然不允许修改它，不过你也可以创建一个可变引用<code>&amp;mut</code>：</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    change</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> change</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(some_string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;mut</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    some_string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push_str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;, world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>引用多了，就不对劲了。引用在各种情况下都挺好用的，看起来也和其他语言一样了，直到……</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{}, {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, r1, r2);</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error[E0499]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> borrow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mutable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> more</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> than</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> once</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> --&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/main.rs:5:14</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     let</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mut</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              ------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> first</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mutable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> borrow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> occurs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> here</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     let</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> r2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mut</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              ^^^^^^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> second</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mutable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> borrow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> occurs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> here</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     println!(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;{}, {}&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> r1,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> r2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                        --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> first</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> borrow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> later</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> used</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> here</span></span></code></pre></div><p>Rust 并不允许同时存在多个可变引用，它会导致数据竞争，这是一些帮助你提早发现问题的限制：</p><ul><li>对于一块内存，同时只能有一个可写引用存在</li><li>对于一块内存，同时可以有多个只读引用存在</li><li>对于一块内存，在有一个可写引用存在的时候，不能有其它引用存在，无论只读或者可写。</li><li>引用的原始对象必须在引用存在的生命期一直有效</li></ul><blockquote><p><strong>数据竞争</strong>（<em>data race</em>）类似于竞态条件，它可由这三个行为造成：</p><ul><li>两个或更多指针同时访问同一数据。</li><li>至少有一个指针被用来写入数据。</li><li>没有同步数据访问的机制。</li></ul></blockquote><h2 id="生命周期" tabindex="-1">生命周期 <a class="header-anchor" href="#生命周期" aria-label="Permalink to &quot;生命周期&quot;">​</a></h2><p>让我们来试着来创建一个引用，并返回它。</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reference_to_nothing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dangle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dangle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这在 C++ 中是可行的，你可以返回这个指针，只不过这块内存依然会被释放，直到你使用访问这块内存并陷入一个 runtime error。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error[E0106]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> missing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lifetime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> specifier</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> --&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main.rs:5:16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dangle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expected</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lifetime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parameter</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">help:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> function&#39;s return type contains a borrowed value, but there is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  no value for it to be borrowed from</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  = help: consider giving it a &#39;static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lifetime</span></span></code></pre></div><p>TODO</p><h2 id="q-a" tabindex="-1">Q&amp;A <a class="header-anchor" href="#q-a" aria-label="Permalink to &quot;Q&amp;A&quot;">​</a></h2><h3 id="是否存在安全的静态-全局-变量" tabindex="-1">是否存在安全的静态（全局）变量？ <a class="header-anchor" href="#是否存在安全的静态-全局-变量" aria-label="Permalink to &quot;是否存在安全的静态（全局）变量？&quot;">​</a></h3><p>不存在，访问和修改可变静态变量都是 <strong>不安全</strong> 的，因为编译器没有足够信息确定多线程间的访问/修改顺序，无法计算其生命周期。</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add_to_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    unsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        COUNTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inc;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    add_to_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    unsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COUNTER: {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNTER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>TODO: 线程安全智能指针</p></blockquote><h3 id="是否存在异步安全的引用变量-其内存如何安排" tabindex="-1">是否存在异步安全的引用变量？其内存如何安排？ <a class="header-anchor" href="#是否存在异步安全的引用变量-其内存如何安排" aria-label="Permalink to &quot;是否存在异步安全的引用变量？其内存如何安排？&quot;">​</a></h3><h2 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-label="Permalink to &quot;Reference&quot;">​</a></h2><ul><li><a href="https://kaisery.github.io/trpl-zh-cn/title-page.html" target="_blank" rel="noreferrer">Rust 程序设计语言 - Rust 程序设计语言 简体中文版 (kaisery.github.io)</a></li></ul></div></div></article><div class="px-10 flex flex-col items-end"><div class="my-2 font-bold">Zexin Yuan</div><div class="text-sm" title="2021-06-19T00:00:00.000Z">2021-6-19</div></div><div class="w-full px-10 my-8 flex flex-col text-gray-600"><div class="my-4 border-t"></div><div class="flex justify-between my-4"><!--[--><!--[--><div class="navigator__prev border-b border-transparent cursor-pointer overflow-hidden whitespace-nowrap text-ellipsis transition-colors hover:border-primary-500 hover:text-primary-500">Vue Conf 21</div><!--]--><!--[--><div class="navigator__next border-b border-transparent cursor-pointer overflow-hidden whitespace-nowrap text-ellipsis transition-colors hover:border-primary-500 hover:text-primary-500">Learn SQL in 10 Minutes</div><!--]--><!--]--></div></div><!--]--></main><aside class="layout__sub"><!--[--><section class="siderbar"></section><!--]--></aside><aside class="layout__extra"><!--[--><section class="sticky top-12 p-4 mr-8"><!--[--><h3 class="pb-1 font-bold">On this page</h3><ul><!--[--><li class="catalog__item p-1 pl-2 border-l transition-colors duration-300 catalog__item--expand"><a class="catalog__link text-gray-500 hover:text-primary-500 cursor-pointer transition-colors duration-300">Rust 与 Ownership</a><ul class="pl-4"><!--[--><li class="catalog__item p-1 pl-2 border-l transition-colors duration-300"><a class="catalog__link text-gray-500 hover:text-primary-500 cursor-pointer transition-colors duration-300">简单的生命周期</a><!----></li><li class="catalog__item p-1 pl-2 border-l transition-colors duration-300"><a class="catalog__link text-gray-500 hover:text-primary-500 cursor-pointer transition-colors duration-300">引用与借用</a><!----></li><li class="catalog__item p-1 pl-2 border-l transition-colors duration-300"><a class="catalog__link text-gray-500 hover:text-primary-500 cursor-pointer transition-colors duration-300">生命周期</a><!----></li><li class="catalog__item p-1 pl-2 border-l transition-colors duration-300"><a class="catalog__link text-gray-500 hover:text-primary-500 cursor-pointer transition-colors duration-300">Q&amp;A</a><!----></li><li class="catalog__item p-1 pl-2 border-l transition-colors duration-300"><a class="catalog__link text-gray-500 hover:text-primary-500 cursor-pointer transition-colors duration-300">Reference</a><!----></li><!--]--></ul></li><!--]--></ul><!--]--></section><!--]--></aside><header class="layout__header"><!--[--><div class="header relative h-full flex flex-col justify-center items-center px-16 overflow-hidden"><div class="flex flex-col items-start"><div class="z-30 min-w-max"><!--[--><a class="header__pill-link mr-2 px-3 py-1 border rounded-full cursor-pointer transition-colors duration-300" style="--pill-link-color:103 58 183;" title="Rust">Rust</a><!--]--></div><h1 class="my-6 z-30 text-8xl font-medium">Rust 与 Ownership</h1></div><div class="text-sm"><span class="pr-2">分类于</span><!--[--><!--[--><span class="underline cursor-pointer transition-colors hover:text-primary-500" title="Computer Science">计算机科学</span><!--[--><span class="px-1">&gt;</span><!--[--><!--[--><span class="underline cursor-pointer transition-colors hover:text-primary-500" title="Language">Language</span><!--[--><span class="px-1">&gt;</span><!--[--><!--[--><span class="underline cursor-pointer transition-colors hover:text-primary-500" title="Rust">Rust</span><!----><!----><!--]--><!--]--><!--]--><!----><!--]--><!--]--><!--]--><!----><!--]--><!--]--></div><!----></div><!--]--></header><footer class="layout__footer"><!--[--><div class="flex flex-col items-center m-4 py-4 text-gray-400 text-sm"><span>Copyright © 2019 – 2023 Zexin Yuan</span><span>Powered by <a href="https://vitepress.dev/" target="_blank" class="underline">Vitepress</a> and <a href="https://github.com/yzx9/vitepress-theme-celesta" target="_blank" class="underline">Theme Celesta</a></span></div><!--]--></footer><nav class="layout__nav overflow-hidden z-50"><!--[--><div class="navbar absolute top-0 left-0 w-full flex justify-between z-50 transition-all"><!--[--><ul class="flex"><!--[--><li class="navbar__link-home navbar__link flex justify-center items-center transition-all font-medium"><a class="font-bold h-full px-4 align-middle cursor-pointer">ZEXIN YUAN&#39;S BLOG</a></li><!--]--></ul><ul class="flex"><!--[--><li class="navbar__link-archives navbar__link flex justify-center items-center transition-all font-medium"><a class="h-full px-4 align-middle cursor-pointer">ARCHIVES</a></li><li class="navbar__link-categories navbar__link flex justify-center items-center transition-all font-medium"><a class="h-full px-4 align-middle cursor-pointer">CATEGORIES</a></li><li class="navbar__link-tags navbar__link flex justify-center items-center transition-all font-medium"><a class="h-full px-4 align-middle cursor-pointer">TAGS</a></li><li class="navbar__link-about navbar__link flex justify-center items-center transition-all font-medium"><a class="h-full px-4 align-middle cursor-pointer">ABOUT</a></li><!--]--></ul><!--]--></div><!--]--></nav><!----></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"readme.md\":\"mbF2uDUR\",\"drafts_error-handing-in-go.md\":\"e_J_JZHQ\",\"drafts_coffee_coffee-waves.md\":\"C91k905T\",\"drafts_coffee_from-seed-to-cup.md\":\"vmrH0GlB\",\"posts_2019_10_28_browser-rendering-process.md\":\"LhNNJCvf\",\"about.md\":\"aPvlBxvz\",\"drafts_coffee_coffee-process.md\":\"i83Vc9ZC\",\"posts_2021_02_15_how-to-read-a-book.md\":\"kOuB7oTn\",\"posts_2021_01_20_coffee.md\":\"38j7FIjD\",\"index.md\":\"DpYZUip9\",\"posts_2019_03_16_oauth2.md\":\"Rov4dQnq\",\"posts_2019_03_16_json-web-token.md\":\"gLhxUsWB\",\"posts_2021_01_02_huffman-tree.md\":\"7P1snOwv\",\"posts_2019_10_24_linear-list.md\":\"pudYwUv7\",\"posts_2021_01_02_avl-tree.md\":\"NBceW6Gl\",\"posts_2019_10_24_string.md\":\"w6r9Nrpv\",\"posts_2019_10_28_browser-same-origin-policy.md\":\"0_3klqaD\",\"posts_2021_01_01_instruction-fetch.md\":\"LH0lGhOG\",\"posts_2021_02_14_b-tree.md\":\"lHeyvYn1\",\"posts_2019_12_08_basic-grammar-of-typescript.md\":\"V9eVIisi\",\"posts_2021_01_02_tree-and-forest.md\":\"A3g01XYT\",\"posts_2019_12_08_note-for-vue2.md\":\"us3MNDJz\",\"posts_2019_10_24_sort.md\":\"dMaqW5x6\",\"posts_2020_12_31_binary-system.md\":\"UyttJv2m\",\"posts_2019_12_18_tcp-protocol.md\":\"TvXGLdLi\",\"drafts_coffee_coffee-cupping.md\":\"7eykArZU\",\"posts_2021_01_02_angularjs-git-commit-message-conventions.md\":\"rcQAwypz\",\"drafts_coffee_gold-cup-standard.md\":\"dUvdF4sg\",\"posts_2021_01_02_binary-sort-tree.md\":\"fKWwhbM1\",\"posts_2019_10_24_graph.md\":\"QfBRWa-7\",\"posts_2019_07_28_high-performance-web-sites-essential.md\":\"3CIlUx8h\",\"posts_2019_10_24_hash.md\":\"uGNMnxN2\",\"posts_2019_12_15_http-protocol.md\":\"OelWw86h\",\"posts_2021_03_10_implement-of-ll1-grammar.md\":\"iHCsV8Rq\",\"posts_2021_03_19_down-top-grammar-analysis.md\":\"gyDyNP4o\",\"posts_2021_06_29_learn-sql-in-10-minutes.md\":\"GNXPqG-P\",\"posts_2021_03_03_some-regular-grammar.md\":\"Ocnm__N7\",\"posts_2021_09_07_matrix-theory-1.md\":\"ZySr9T1w\",\"posts_2021_10_31_games101.md\":\"hTfkc6vX\",\"posts_2021_05_22_vue-conf-21.md\":\"uwOw46sw\",\"posts_2021_03_13_sdd-and-sdt.md\":\"wTqNj9wQ\",\"posts_2021_03_11_naming-for-clean-code.md\":\"l-BdEaMP\",\"posts_2021_06_19_rust-and-ownership.md\":\"bNgm5KjL\",\"posts_2021_02_26_regular-grammar-and-automata.md\":\"w1x80IYP\",\"posts_2022_04_02_pipeline-in-go.md\":\"xsVNoKSy\",\"posts_2021_12_14_games101-material.md\":\"vauHDbcG\",\"posts_2023_08_14_cns2023-s46.md\":\"iv1iuySn\",\"posts_2022_04_04_cancel-goroutine.md\":\"VRKnsS3d\",\"posts_2023_11_08_nervous-system.md\":\"fPfTx3Ve\",\"posts_2023_11_09_neuron.md\":\"QkTzGdZr\",\"posts_2023_12_10_neuron-electrical-activity.md\":\"j0mYRdko\",\"posts_2021_12_18_games101-animation-simulation.md\":\"bZBC0ELr\",\"posts_2021_03_16_is-it-an-ll1-grammar.md\":\"CoeCsr3L\",\"posts_2023_11_13_neuron-activity-principle.md\":\"B73r2cZt\",\"posts_2022_04_29_architectures-of-ddd.md\":\"I-3EEqYf\",\"posts_2021_03_11_clean-code.md\":\"vDzS8uan\",\"posts_2021_11_18_games101-geometry.md\":\"QGv74mZj\",\"posts_2021_02_16_propositional-calculus.md\":\"x0PQymIy\",\"posts_2021_11_13_games101-rasterization.md\":\"aT3JQKTI\",\"posts_2023_12_11_neurotransmitters-receptors.md\":\"EbqbbWSJ\",\"posts_2022_03_28_concurrency-tools-in-go.md\":\"Pvr26_dt\",\"posts_2021_12_16_games101-light-transport.md\":\"8g4qC8aJ\",\"posts_2021_11_30_games101-ray-tracing.md\":\"QXLupLAL\",\"posts_2021_03_08_top-down-grammar-parsing.md\":\"SA-Qg1ZO\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"VitePress\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{},\"locales\":{\"root\":{\"label\":\"中文\",\"lang\":\"zh\",\"title\":\"Zexin Yuan's blog\",\"description\":\"Technique && Life\",\"themeConfig\":{\"author\":\"Zexin Yuan\",\"tag\":{\"Computer Science\":\"计算机科学\",\"Computer Organization\":\"计算机组成\",\"Computer Graphics\":\"计算机图形学\",\"Data Structure\":\"数据结构\",\"Software Engineering\":\"软件工程\",\"Architecture\":\"架构\",\"Tree\":\"树\",\"Network\":\"计算机网络\",\"Performance\":\"性能\",\"Authorization\":\"认证\",\"Front End\":\"前端\",\"Browser\":\"浏览器\",\"Compiler\":\"编译原理\",\"Grammar\":\"语法\",\"Automata\":\"自动机\",\"Life\":\"日常\",\"Coffee\":\"咖啡\",\"Course\":\"课程\",\"Math\":\"数学\",\"Discrete Mathematical\":\"离散数学\"},\"category\":{\"Computer Science\":\"计算机科学\",\"Computer Organization\":\"计算机组成\",\"Computer Graphics\":\"计算机图形学\",\"Data Structure\":\"数据结构\",\"Software Engineering\":\"软件工程\",\"Architecture\":\"架构\",\"Tree\":\"树\",\"Network\":\"计算机网络\",\"Performance\":\"性能\",\"Authorization\":\"认证\",\"Front End\":\"前端\",\"Browser\":\"浏览器\",\"Compiler\":\"编译原理\",\"Grammar\":\"语法\",\"Automata\":\"自动机\",\"Life\":\"日常\",\"Coffee\":\"咖啡\",\"Course\":\"课程\",\"Math\":\"数学\",\"Discrete Mathematical\":\"离散数学\"}}}},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>