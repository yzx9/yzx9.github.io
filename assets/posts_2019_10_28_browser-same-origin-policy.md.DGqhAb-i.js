import{g as a,h as i,o as s,j as e}from"./chunks/framework.BOQ8FqoK.js";const E=JSON.parse('{"title":"浏览器同源政策","description":"","frontmatter":{"date":"2019-10-28T00:00:00.000Z","updated":"2019-10-28T00:00:00.000Z","categories":["Computer Science","Front End"],"tags":["Browser"]},"headers":[{"level":1,"title":"浏览器同源政策","slug":"浏览器同源政策","link":"#浏览器同源政策","children":[{"level":2,"title":"判断方式","slug":"判断方式","link":"#判断方式","children":[{"level":3,"title":"Cookie、LocalStorage 和 IndexDB 无法读取","slug":"cookie、localstorage-和-indexdb-无法读取","link":"#cookie、localstorage-和-indexdb-无法读取","children":[]},{"level":3,"title":"DOM 无法获得","slug":"dom-无法获得","link":"#dom-无法获得","children":[]},{"level":3,"title":"解决方法","slug":"解决方法","link":"#解决方法","children":[]}]},{"level":2,"title":"AJAX 请求不能发送","slug":"ajax-请求不能发送","link":"#ajax-请求不能发送","children":[{"level":3,"title":"JSONP","slug":"jsonp","link":"#jsonp","children":[]},{"level":3,"title":"WebSocket","slug":"websocket","link":"#websocket","children":[]},{"level":3,"title":"CORS","slug":"cors","link":"#cors","children":[]}]}]}],"relativePath":"posts/2019/10/28/browser-same-origin-policy.md","filePath":"posts/2019/10/28/browser-same-origin-policy.md"}'),l={name:"posts/2019/10/28/browser-same-origin-policy.md"},n=e(`<h1 id="浏览器同源政策" tabindex="-1">浏览器同源政策 <a class="header-anchor" href="#浏览器同源政策" aria-label="Permalink to &quot;浏览器同源政策&quot;">​</a></h1><h2 id="判断方式" tabindex="-1">判断方式 <a class="header-anchor" href="#判断方式" aria-label="Permalink to &quot;判断方式&quot;">​</a></h2><ol><li>协议相同</li><li>域名相同</li><li>端口相同</li></ol><h3 id="cookie、localstorage-和-indexdb-无法读取" tabindex="-1">Cookie、LocalStorage 和 IndexDB 无法读取 <a class="header-anchor" href="#cookie、localstorage-和-indexdb-无法读取" aria-label="Permalink to &quot;Cookie、LocalStorage 和 IndexDB 无法读取&quot;">​</a></h3><p>Cookie 只有同源的网页才能共享</p><ul><li>如果一级域名相同, 可以将两个页面设置相同的 domain 共享 Cookie</li></ul><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.domain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 指定Cookie的所属域名为一级域名</span></span></code></pre></div><h3 id="dom-无法获得" tabindex="-1">DOM 无法获得 <a class="header-anchor" href="#dom-无法获得" aria-label="Permalink to &quot;DOM 无法获得&quot;">​</a></h3><p>以下代码受到限制</p><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myIFrame&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).contentWindow.document</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.parent.document.body</span></span></code></pre></div><h3 id="解决方法" tabindex="-1">解决方法 <a class="header-anchor" href="#解决方法" aria-label="Permalink to &quot;解决方法&quot;">​</a></h3><h4 id="一级域名相同" tabindex="-1">一级域名相同 <a class="header-anchor" href="#一级域名相同" aria-label="Permalink to &quot;一级域名相同&quot;">​</a></h4><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.domain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 两个网站都需要设置, 且完全相等</span></span></code></pre></div><h4 id="一级域名不相同" tabindex="-1">一级域名不相同 <a class="header-anchor" href="#一级域名不相同" aria-label="Permalink to &quot;一级域名不相同&quot;">​</a></h4><h5 id="片段识别符" tabindex="-1">片段识别符 <a class="header-anchor" href="#片段识别符" aria-label="Permalink to &quot;片段识别符&quot;">​</a></h5><p><strong>原理</strong>: 只改变片段标识符，不会引起页面刷新</p><ol><li>父窗口写 <code>URL#hash</code></li><li>子窗口监听 hashchange</li></ol><h5 id="window-name" tabindex="-1">window.name <a class="header-anchor" href="#window-name" aria-label="Permalink to &quot;window.name&quot;">​</a></h5><p><strong>原理</strong>: window.name容量很大，可以放置非常长的字符串</p><p><strong>缺点</strong>: 必须监听子窗口window.name属性的变化，影响网页性能</p><ol><li>父窗口打开子窗口，写入 name</li><li>子窗口写入name，跳转至父窗口同域名网页</li></ol><h5 id="cross-document-messaging" tabindex="-1">cross-document messaging <a class="header-anchor" href="#cross-document-messaging" aria-label="Permalink to &quot;cross-document messaging&quot;">​</a></h5><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello World!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://bbb.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handleMessage)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  source, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 发送消息的窗口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  origin, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 消息发向的网址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  data </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 消息内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="ajax-请求不能发送" tabindex="-1">AJAX 请求不能发送 <a class="header-anchor" href="#ajax-请求不能发送" aria-label="Permalink to &quot;AJAX 请求不能发送&quot;">​</a></h2><h3 id="jsonp" tabindex="-1">JSONP <a class="header-anchor" href="#jsonp" aria-label="Permalink to &quot;JSONP&quot;">​</a></h3><p>添加一个&lt;script&gt;元素，向服务器请求JSON数据</p><p>缺点: 只能发送 GET 请求</p><h3 id="websocket" tabindex="-1">WebSocket <a class="header-anchor" href="#websocket" aria-label="Permalink to &quot;WebSocket&quot;">​</a></h3><p>设置 origin</p><h3 id="cors" tabindex="-1">CORS <a class="header-anchor" href="#cors" aria-label="Permalink to &quot;CORS&quot;">​</a></h3><h4 id="简单请求" tabindex="-1">简单请求 <a class="header-anchor" href="#简单请求" aria-label="Permalink to &quot;简单请求&quot;">​</a></h4><p><strong>条件</strong></p><ol><li>三种类型之一: HEAD, GET, POST</li><li>只允许以下头信息: Accept, Accept-Language, Content-Language, Last-Event-ID</li><li>Content-Type: 限于三个值 <ul><li>application/x-www-form-urlencoded</li><li>multipart/form-data</li><li>text/plain</li></ul></li></ol><h4 id="非简单请求" tabindex="-1">非简单请求 <a class="header-anchor" href="#非简单请求" aria-label="Permalink to &quot;非简单请求&quot;">​</a></h4>`,34),t=[n];function o(h,r,d,p,k,c){return s(),i("div",null,t)}const u=a(l,[["render",o]]);export{E as __pageData,u as default};
